<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Analyzer</title>
    <style>
        #preloader-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.85); backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center;
            z-index: 9999; flex-direction: column;
        }
        #preloader-img { width: 150px; height: auto; margin-bottom: 20px; }
        #preloader-overlay p { font-size: 1.2em; color: #f0f0f0; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 242, 234, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 242, 234, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 242, 234, 0); }
        }
        @keyframes zoomIn {
            from {transform: scale(0.8); opacity: 0;}
            to {transform: scale(1); opacity: 1;}
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        :root {
            --accent-color: #00f2ea;
            --glass-bg: rgba(30, 30, 30, 0.7);
            --glass-light-bg: rgba(45, 45, 45, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-blur: blur(10px);
            --text-color: #f5f5f5;
            --text-secondary: #c0c0c0;
            --text-dark: #121212;
            --smooth-curve: cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --text-shadow: 0 1px 3px rgba(0, 0, 0, 0.6);
            --danger-color: #ff4d4d;
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            margin: 0; padding: 0; color: var(--text-color);
            background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSFGhXiiq2MbBvBym_bR-K2Ha-slKfUK9ns_kgBOha398NrMrCm1aG4q6woNPXv6zn4CUY&usqp=CAU');
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            background-repeat: no-repeat;
        }

        #welcome-screen {
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; height: 100vh; padding: 20px;
            text-align: center; animation: fadeIn 1s var(--smooth-curve);
        }
        #welcome-gif {
            width: 200px; height: auto; border-radius: 10px; margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: fadeIn 1s var(--smooth-curve) 0.1s backwards;
        }
        #welcome-screen h1 {
            font-size: 3em; color: white; text-shadow: var(--text-shadow);
            margin-bottom: 10px; animation: fadeIn 1s var(--smooth-curve) 0.3s backwards;
        }
        #welcome-screen .welcome-subtitle {
            font-size: 1.2em;
            color: var(--accent-color);
            text-shadow: 0 1px 2px rgba(0,0,0,0.4);
            font-weight: 500;
            max-width: 500px; margin-bottom: 25px;
            animation: fadeIn 1s var(--smooth-curve) 0.5s backwards;
        }
        .cta-button {
            display: inline-block; padding: 15px 35px; margin-top: 20px;
            background: var(--accent-color); color: var(--text-dark); border: none;
            border-radius: 50px; cursor: pointer; font-size: 1.1em; font-weight: bold;
            text-decoration: none; transition: all 0.3s var(--smooth-curve);
            animation: fadeIn 1s var(--smooth-curve) 0.7s backwards;
        }
        .cta-button:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 242, 234, 0.3);
        }

        .main-content { padding: 20px 10px; }

        nav, .upload-container, .results-header, footer { /* Removed largest-transactions */
            max-width: 1000px; margin: 20px auto; padding: 25px;
            background: var(--glass-bg); backdrop-filter: var(--glass-blur);
            border-radius: 12px; border: 1px solid var(--glass-border);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        .upload-container { animation: fadeIn 0.6s var(--smooth-curve); }

        .brand { font-size: 1.3em; font-weight: bold; color: var(--accent-color); }
        nav { display: flex; justify-content: space-between; align-items: center; padding: 15px 25px; }
        .nav-link { font-size: 0.9em; font-weight: 500; color: var(--accent-color); text-decoration: none; transition: opacity 0.3s var(--smooth-curve); }
        .nav-link:hover { opacity: 0.8; }

        h2 { color: var(--text-color); padding-bottom: 10px; margin-top: 0; margin-bottom: 20px; position: relative; text-shadow: var(--text-shadow); }
        h2::after { content: ''; display: block; width: 80px; height: 4px; background: var(--accent-color); margin-top: 10px; border-radius: 2px; }
        p { color: var(--text-secondary); line-height: 1.6; }

        .upload-container h2 { animation: fadeIn 0.5s ease-out 0.1s backwards; }
        .upload-container > p { animation: fadeIn 0.5s ease-out 0.2s backwards; }
        .upload-container .upload-form { animation: fadeIn 0.5s ease-out 0.3s backwards; }

        .upload-form { padding: 20px; border-radius: 8px; background: var(--glass-light-bg); backdrop-filter: var(--glass-blur); border: 1px solid var(--glass-border); text-align: center; }
        input[type="file"] { display: none; }
        .custom-file-upload { display: inline-block; padding: 12px 25px; background-color: var(--accent-color); color: var(--text-dark); border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s var(--smooth-curve); animation: pulse 2.5s infinite 1s; }
        .custom-file-upload:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0, 242, 234, 0.3); animation: none; }
        #file-name { display: block; margin-top: 15px; font-style: italic; color: #aaa; }
        button[type="submit"] { display: block; width: 80%; margin: 25px auto 0; padding: 12px 18px; background: var(--accent-color); color: var(--text-dark); border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; transition: all 0.3s var(--smooth-curve); }
        button[type="submit"]:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0, 242, 234, 0.3); }

        .error { color: #ffc4c4; background-color: rgba(140, 28, 28, 0.7); backdrop-filter: var(--glass-blur); border: 1px solid #ff4d4d; padding: 15px; border-radius: 8px; margin-top: 20px; font-weight: bold; animation: fadeIn 0.5s ease-out; }

        .results { max-width: 1000px; margin: 20px auto; text-align: center; }
        .results-header { margin-bottom: 20px; animation: slideUp 0.6s var(--smooth-curve) forwards; opacity: 0; animation-delay: 0.1s; }
        .download-buttons { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin-top: 10px; }
        .graph-row { display: flex; flex-wrap: wrap; justify-content: space-around; gap: 20px; margin-top: 20px; }
        .graph-container {
            flex: 1 1 45%; min-width: 300px; padding: 20px; background: var(--glass-light-bg);
            backdrop-filter: var(--glass-blur); border: 1px solid var(--glass-border);
            border-radius: 8px; box-shadow: var(--light-shadow); transition: all 0.3s var(--smooth-curve);
            opacity: 0; animation: slideUp 0.6s var(--smooth-curve) forwards;
        }
        .results .graph-row:nth-of-type(1) .graph-container:nth-child(1) { animation-delay: 0.2s; }
        .results .graph-row:nth-of-type(1) .graph-container:nth-child(2) { animation-delay: 0.3s; }
        .results .graph-row:nth-of-type(2) .graph-container:nth-child(1) { animation-delay: 0.4s; }
        .results .graph-row:nth-of-type(2) .graph-container:nth-child(2) { animation-delay: 0.5s; }
        .results .graph-row:nth-of-type(3) .graph-container:nth-child(1) { animation-delay: 0.6s; }
        .results .graph-row:nth-of-type(3) .graph-container:nth-child(2) { animation-delay: 0.7s; }
        .results .graph-row:nth-of-type(4) .graph-container:nth-child(1) { animation-delay: 0.8s; }


        .graph-container:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3); }
        .graph-container.full-width { flex-basis: 100%; }
        h3 { color: var(--text-color); font-size: 1.3em; margin-top: 0; margin-bottom: 15px; font-weight: 600; border-bottom: 1px solid var(--glass-border); padding-bottom: 10px; text-shadow: var(--text-shadow); }
        .graph-container img { max-width: 100%; height: auto; border-radius: 4px; cursor: pointer; transition: opacity 0.3s var(--smooth-curve); }
        .graph-container img:hover { opacity: 0.9; }

        a.download-link { display: inline-block; width: auto; margin: 5px; padding: 10px 20px; background: var(--accent-color); color: var(--text-dark); text-decoration: none; border: none; border-radius: 5px; font-weight: 500; font-size: 0.95em; transition: all 0.3s var(--smooth-curve); }
        a.download-link:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0, 242, 234, 0.2); }

        .upload-note { font-size: 0.9em; color: var(--text-secondary); margin: 15px 0 5px 0; text-align: left; padding: 10px 15px; background: rgba(0,0,0,0.1); border-radius: 5px; border: 1px solid rgba(255, 255, 255, 0.05); }
        .upload-note.important { color: var(--danger-color); background: rgba(255, 77, 77, 0.1); border-color: rgba(255, 77, 77, 0.3); }
        .upload-note strong { color: var(--text-color); }
        .upload-note.important strong { color: #ffc4c4; }
        .upload-note a { color: var(--accent-color); font-weight: 500; text-decoration: none; }
        .upload-note a:hover { text-decoration: underline; }
        .privacy-note { margin-top: 20px; font-size: 0.85em; color: #aaa; line-height: 1.5; }
        .privacy-note .icon, .privacy-note strong { color: var(--danger-color); }
        .icon { margin-right: 8px; font-size: 1.1em; vertical-align: middle; color: var(--text-secondary); }
        .upload-note .icon { color: var(--accent-color); }

        /* REMOVED largest-transactions styles */

        footer { margin-top: 40px; padding: 20px; text-align: center; font-size: 0.9em; color: var(--text-secondary); background-color: var(--glass-bg); backdrop-filter: var(--glass-blur); border-top: 1px solid var(--glass-border); box-shadow: none; border-radius: 0; animation: none; max-width: none; }
        footer h4 { color: var(--text-color); margin-top: 0; margin-bottom: 10px; font-size: 1.1em; font-weight: 600; }
        footer p { font-size: 0.9em; margin: 5px 0; max-width: 800px; margin-left: auto; margin-right: auto; }
        footer .privacy-note { margin-top: 15px; font-size: 0.8em; color: #aaa; }
        footer .privacy-note .icon, footer .privacy-note strong { color: var(--danger-color); }


        #lightbox { display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.9); backdrop-filter: blur(5px); justify-content: center; align-items: center; cursor: pointer; }
        #lightbox img { margin: auto; display: block; max-width: 90%; max-height: 85vh; border-radius: 5px; animation: zoomIn 0.4s var(--smooth-curve); cursor: default; }
        .close-lightbox { position: absolute; top: 20px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; transition: 0.3s; cursor: pointer; z-index: 10001; text-shadow: 0 2px 5px rgba(0,0,0,0.7); }
        .close-lightbox:hover, .close-lightbox:focus { color: #bbb; text-decoration: none; }


        @media (max-width: 768px) {
            body { padding: 0; }
            .main-content { padding: 10px; }
            #welcome-screen h1 { font-size: 2.2em; }
            #welcome-screen .welcome-subtitle { font-size: 1em; }
            #welcome-gif { width: 150px; }
            nav, .upload-container, .results-header, footer { padding: 15px; margin: 10px; border-radius: 8px; } /* Removed largest-transactions */
            .brand { font-size: 1.1em; }
            .nav-link { font-size: 0.8em; }
            h2 { font-size: 1.4em; }
            .graph-row { flex-direction: column; gap: 15px; margin-top: 15px; }
            .graph-container { min-width: 95%; }
            button[type="submit"], a.download-link { width: 90%; padding: 12px 18px; }
            .download-buttons { flex-direction: column; align-items: center; gap: 10px; }
            #lightbox img { max-width: 95%; }
            .close-lightbox { top: 15px; right: 25px; font-size: 30px; }
            /* REMOVED .txn-columns and .txn-list mobile styles */
            footer { margin-top: 30px; }
        }

    </style>
</head>
<body>

    <div id="preloader-overlay">
        <img id="preloader-img" src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExbnJ1bnU1YzRucDZta2tyMjBsOXBpbzIzZDhyZzl1Nnl0ZjN0ejU1YSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/gEV1qGHF20sVI3j8OT/giphy.gif" alt="Analyzing...">
        <p>Analyzing your statement...</p>
    </div>

    <div id="lightbox" onclick="closeLightbox()">
        <span class="close-lightbox" onclick="closeLightbox()">&times;</span>
        <img id="lightbox-img" src="" alt="Expanded Graph" onclick="event.stopPropagation()">
    </div>


    {% if not category_pie_url %}

        <div id="welcome-screen">
            <img id="welcome-gif" src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExbnJ1bnU1YzRucDZta2tyMjBsOXBpbzIzZDhyZzl1Nnl0ZjN0ejU1YSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/gEV1qGHF20sVI3j8OT/giphy.gif" alt="Finance Animation">
            <h1>Welcome to the Finance Analyzer</h1>
            <p class="welcome-subtitle">
               Get a complete, visual analysis of your financial statements in seconds.
               Your data is secure and never saved.
            </p>
            <a href="#upload-section" class="cta-button">Get Started</a>
        </div>

        <div class="main-content" id="upload-section">
            <nav>
                <div class="brand">Finance Analyzer</div>
            </nav>

            {% if error %}
                <div class="upload-container">
                    <p class="error">{{ error }}</p>
                    <a href="/" class="nav-link" style="text-align: center; display: block; margin-top: 20px;">Try Again</a>
                </div>
            {% endif %}

            {% if not error %}
            <div class="upload-container">
                <h2>Upload Your Statement</h2>
                <p>Upload your Excel file (.xlsx or .xls) to generate your personal dashboard.</p>

                <form class="upload-form" action="/upload" method="POST" enctype="multipart/form-data" onsubmit="showPreloader()">

                    <p class="upload-note important">
                        <span class="icon">&#128193;</span>
                        We only accept <strong>Excel files (.xlsx or .xls)</strong>.
                    </p>
                    <p class="upload-note">
                        <span class="icon">&#128190;</span>
                        Need to convert a PDF? Try a free tool like
                        <a href="https://www.ilovepdf.com/pdf_to_excel" target="_blank" rel="noopener noreferrer">iLovePDF</a>.
                    </p>

                    <label for="file-upload" class="custom-file-upload" style="margin-top: 20px;">
                        <span class="icon">&#128193;</span> Choose Excel File
                    </label>
                    <input id="file-upload" type="file" name="file" accept=".xlsx, .xls" required onchange="updateFileName(this)">
                    <span id="file-name">No file selected.</span>

                    <button type="submit">Analyze Now</button>

                </form>
            </div>
            {% endif %}

        </div>

    {% else %}

        <nav>
            <div class="brand">Finance Analyzer</div>
            <a href="/" class="nav-link">Upload New File</a>
        </nav>

        <div class="results">

            <div class="results-header">
                <h2>Your Financial Analysis</h2>
                <p style="font-size: 1.1em; color: var(--text-secondary); margin-top: -15px;">
                    Analysis Period: <strong>{{ start_date }}</strong> to <strong>{{ end_date }}</strong>
                </p>
                <div class="download-buttons">
                    <a class="download-link" href="{{ url_for('download_file', filename=download_filename) }}">
                       <span class="icon">&#128196;</span> Download Report (.xlsx)
                    </a>
                </div>
            </div>

            <div class="graph-row">
                {% if category_pie_url %}
                 <div class="graph-container">
                    <h3>Spending by Category</h3>
                    <img src="{{ url_for('static', filename=category_pie_url) }}?v={{ range(1, 100000) | random }}"
                         alt="Spending by Category Pie Chart" onclick="openLightbox(this)">
                </div>
                {% endif %}

                {% if pie_chart_url %}
                <div class="graph-container">
                    <h3>Total Debit vs. Credit</h3>
                    <img src="{{ url_for('static', filename=pie_chart_url) }}?v={{ range(1, 100000) | random }}"
                         alt="Debit vs Credit Pie Chart" onclick="openLightbox(this)">
                </div>
                {% endif %}
            </div>

            <div class="graph-row">
                 {% if trend_url %}
                <div class="graph-container">
                    <h3>Income vs. Expense Trend</h3>
                    <img src="{{ url_for('static', filename=trend_url) }}?v={{ range(1, 100000) | random }}"
                         alt="Income vs Expense Trend Graph" onclick="openLightbox(this)">
                </div>
                {% endif %}

                {% if day_of_week_url %}
                <div class="graph-container">
                    <h3>Spending by Day</h3>
                    <img src="{{ url_for('static', filename=day_of_week_url) }}?v={{ range(1, 100000) | random }}"
                         alt="Spending by Day of Week Graph" onclick="openLightbox(this)">
                </div>
                {% endif %}
            </div>

            <div class="graph-row">
                <div class="graph-container">
                    <h3>Monthly Debit vs. Credit</h3>
                    <img src="{{ url_for('static', filename=graph_url) }}?v={{ range(1, 100000) | random }}"
                         alt="Monthly Summary Graph" onclick="openLightbox(this)">
                </div>

                <div class="graph-container">
                    <h3>Balance Over Time</h3>
                    <img src="{{ url_for('static', filename=cum_graph_url) }}?v={{ range(1, 100000) | random }}"
                         alt="Cumulative Balance Graph" onclick="openLightbox(this)">
                </div>
            </div>

            <div class="graph-row">
                {% if top_10_graph_url %}
                <div class="graph-container full-width">
                    <h3>Top 10 Payees/Details</h3>
                    <img src="{{ url_for('static', filename=top_10_graph_url) }}?v={{ range(1, 100000) | random }}"
                         alt="Top 10 Spending Graph" onclick="openLightbox(this)">
                </div>
                {% endif %}
            </div>

        </div>

    {% endif %}


    <footer>
        <h4>Disclaimer</h4>
        <p>This tool provides automated financial visualizations. It is not financial advice. Always verify data with official statements before making decisions.</p>
        <p class="privacy-note important">
            <span class="icon">&#128274;</span>
            <strong>Privacy:</strong> Your uploaded files are processed in memory and are <strong>not stored</strong> on our servers. Your financial data remains private.
        </p>
    </footer>


    <script>
        function showPreloader() {
            const fileInput = document.getElementById('file-upload');
            if (fileInput && fileInput.files.length > 0) {
                document.getElementById('preloader-overlay').style.display = 'flex';
            } else {
                 event.preventDefault();
                 alert("Please choose an Excel file first.");
            }
        }
        function updateFileName(input) {
            const fileName = input.files[0] ? input.files[0].name : 'No file selected.';
            document.getElementById('file-name').textContent = fileName;
        }

        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');

        function openLightbox(imgElement) {
            if (lightbox && lightboxImg) {
                lightboxImg.src = imgElement.src;
                lightbox.style.display = 'flex';
                 document.body.style.overflow = 'hidden';
            }
        }

        function closeLightbox() {
            if (lightbox) {
                lightbox.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }
    </script>

</body>
</html>